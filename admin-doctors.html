<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doctors — MediCore</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="navbar">
  <div class="nav-brand"><span class="nav-icon">⚕</span><span class="brand-name">MediCore</span></div>
  <div class="nav-links">
    <a class="nav-link" href="admin-dashboard.html">Dashboard</a>
    <a class="nav-link active" href="admin-doctors.html">Doctors</a>
    <a class="nav-link" href="admin-patients.html">Patients</a>
    <a class="nav-link" href="admin-appointments.html">Appointments</a>
  </div>
  <div class="nav-user">
    <span class="role-badge role-admin">Admin</span>
    <span class="user-name">Admin</span>
    <a href="login.html" class="btn-logout">Logout</a>
  </div>
</nav>

<div class="main-content">
  <div class="page-header fade-in">
    <div>
      <h1 class="page-title">Doctors</h1>
      <p class="page-sub" id="docCount">Loading...</p>
    </div>
    <button class="btn-primary" onclick="openModal('addModal')">+ Add Doctor</button>
  </div>

  <div class="filter-bar fade-in">
    <input type="text" class="search-input" id="searchInput" placeholder="Search by name or specialty..." oninput="renderTable()">
    <select class="filter-select" id="specFilter" onchange="renderTable()">
      <option value="">All Specialties</option>
      <option>Cardiology</option><option>Neurology</option><option>Orthopedics</option>
      <option>Pediatrics</option><option>Dermatology</option><option>General Medicine</option>
      <option>Gynecology</option><option>Ophthalmology</option>
    </select>
    <select class="filter-select" id="availFilter" onchange="renderTable()">
      <option value="">All Status</option>
      <option value="1">Available</option>
      <option value="0">Unavailable</option>
    </select>
  </div>

  <div class="section-card fade-in">
    <div class="table-wrap">
      <table class="data-table">
        <thead>
          <tr><th>#</th><th>Name</th><th>Specialty</th><th>Email</th><th>Phone</th><th>Status</th><th>Actions</th></tr>
        </thead>
        <tbody id="docTableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Add Doctor Modal -->
<div id="addModal" class="modal-overlay" style="display:none">
  <div class="modal">
    <div class="modal-header">
      <h3>Add New Doctor</h3>
      <button class="modal-close" onclick="closeModal('addModal')">✕</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group"><label>Full Name</label><input id="addName" placeholder="Dr. First Last"></div>
        <div class="form-group"><label>Specialty</label>
          <select id="addSpec">
            <option value="">Select</option>
            <option>Cardiology</option><option>Neurology</option><option>Orthopedics</option>
            <option>Pediatrics</option><option>Dermatology</option><option>General Medicine</option>
            <option>Gynecology</option><option>Ophthalmology</option><option>ENT</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Email</label><input type="email" id="addEmail" placeholder="doctor@clinic.com"></div>
        <div class="form-group"><label>Phone</label><input id="addPhone" placeholder="9876543210"></div>
      </div>
      <div class="form-group"><label>Password</label><input type="password" id="addPassword" placeholder="Login password"></div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeModal('addModal')">Cancel</button>
      <button class="btn-primary" onclick="addDoctor()">Add Doctor</button>
    </div>
  </div>
</div>

<!-- Edit Doctor Modal -->
<div id="editModal" class="modal-overlay" style="display:none">
  <div class="modal">
    <div class="modal-header">
      <h3>Edit Doctor</h3>
      <button class="modal-close" onclick="closeModal('editModal')">✕</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="editId">
      <div class="form-row">
        <div class="form-group"><label>Full Name</label><input id="editName"></div>
        <div class="form-group"><label>Specialty</label>
          <select id="editSpec">
            <option>Cardiology</option><option>Neurology</option><option>Orthopedics</option>
            <option>Pediatrics</option><option>Dermatology</option><option>General Medicine</option>
            <option>Gynecology</option><option>Ophthalmology</option><option>ENT</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Email</label><input type="email" id="editEmail"></div>
        <div class="form-group"><label>Phone</label><input id="editPhone"></div>
      </div>
      <div class="form-group"><label>Status</label>
        <select id="editAvail">
          <option value="1">Available</option>
          <option value="0">Unavailable</option>
        </select>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeModal('editModal')">Cancel</button>
      <button class="btn-primary" onclick="saveEdit()">Save Changes</button>
    </div>
  </div>
</div>

<script src="main.js"></script>
<script src="data.js"></script>
<script>
  function renderTable() {
    const q = document.getElementById('searchInput').value.toLowerCase();
    const spec = document.getElementById('specFilter').value;
    const avail = document.getElementById('availFilter').value;
    const docs = getDoctors().filter(d =>
      (!q || d.name.toLowerCase().includes(q) || d.specialty.toLowerCase().includes(q)) &&
      (!spec || d.specialty === spec) &&
      (avail === '' || String(d.available) === avail)
    );
    document.getElementById('docCount').textContent = `${docs.length} doctor${docs.length !== 1 ? 's' : ''} on record`;
    const tbody = document.getElementById('docTableBody');
    if (docs.length === 0) {
      tbody.innerHTML = '<tr><td colspan="7" class="empty">No doctors found.</td></tr>';
      return;
    }
    tbody.innerHTML = docs.map(d => `
      <tr>
        <td class="muted">${d.id}</td>
        <td><strong>${d.name}</strong></td>
        <td>${d.specialty}</td>
        <td class="muted">${d.email}</td>
        <td class="muted">${d.phone}</td>
        <td><span class="badge ${d.available ? 'badge-available' : 'badge-cancelled'}">${d.available ? 'Available' : 'Unavailable'}</span></td>
        <td class="actions">
          <button class="btn-sm btn-edit" onclick="openEdit(${d.id})">Edit</button>
          <button class="btn-sm btn-delete" onclick="deleteDoc(${d.id})">Delete</button>
        </td>
      </tr>
    `).join('');
  }

  function addDoctor() {
    const name = document.getElementById('addName').value.trim();
    const spec = document.getElementById('addSpec').value;
    const email = document.getElementById('addEmail').value.trim();
    const phone = document.getElementById('addPhone').value.trim();
    if (!name || !spec || !email || !phone) { showToast('Please fill all fields.', 'error'); return; }
    const docs = getDoctors();
    if (docs.find(d => d.email === email)) { showToast('Email already exists.', 'error'); return; }
    docs.push({ id: Date.now(), name, specialty: spec, email, phone, available: 1 });
    saveDoctors(docs);
    closeModal('addModal');
    showToast('Doctor added successfully.');
    renderTable();
  }

  function openEdit(id) {
    const d = getDoctors().find(d => d.id === id);
    if (!d) return;
    document.getElementById('editId').value = id;
    document.getElementById('editName').value = d.name;
    document.getElementById('editSpec').value = d.specialty;
    document.getElementById('editEmail').value = d.email;
    document.getElementById('editPhone').value = d.phone;
    document.getElementById('editAvail').value = d.available;
    openModal('editModal');
  }

  function saveEdit() {
    const id = Number(document.getElementById('editId').value);
    const docs = getDoctors().map(d => d.id === id ? {
      ...d,
      name: document.getElementById('editName').value,
      specialty: document.getElementById('editSpec').value,
      email: document.getElementById('editEmail').value,
      phone: document.getElementById('editPhone').value,
      available: Number(document.getElementById('editAvail').value),
    } : d);
    saveDoctors(docs);
    closeModal('editModal');
    showToast('Doctor updated.');
    renderTable();
  }

  function deleteDoc(id) {
    confirmAction('Delete this doctor and all their appointments?', () => {
      saveDoctors(getDoctors().filter(d => d.id !== id));
      saveAppointments(getAppointments().filter(a => a.doctorId !== id));
      showToast('Doctor removed.', 'error');
      renderTable();
    });
  }

  renderTable();
</script>
</body>
</html>
